// Hero images
const heroImages = [{
    url: "signal-2025-12-16-160747.jpeg",
  },
  {
    url: "signal-2025-12-16-160747_018.jpeg",
  },
  {
    url: "signal-2025-12-16-160747_002.jpeg",
  },
  {
    url: "signal-2025-12-16-160747_003.jpeg",
  },
  {
    url: "signal-2025-12-16-160747_004.jpeg",
  },
  {
    url: "signal-2025-12-16-160747_006.jpeg",
  },
  {
    url: "signal-2025-12-16-160747_007.jpeg",
  },
  {
    url: "signal-2025-12-16-160747_008.jpeg",
  },
  {
    url: "signal-2025-12-16-160747_009.jpeg",
  },
  {
    url: "signal-2025-12-16-160747_010.jpeg",
  },
  {
    url: "signal-2025-12-16-160747_012.jpeg",
  },
  {
    url: "signal-2025-12-16-160747_013.jpeg",
  },
  {
    url: "signal-2025-12-16-160747_014.jpeg",
  },
  {
    url: "signal-2025-12-16-160747_015.jpeg",
  },
  {
    url: "signal-2025-12-16-160747_016.jpeg",
  },
  {
    url: "signal-2025-12-16-160747_017.jpeg",
  },
  {
    url: "signal-2025-12-16-160747_019.jpeg",
  },
  {
    url: "signal-2025-12-16-160747_020.jpeg",
  },
  {
    url: "signal-2025-12-16-160747_022.jpeg",
  },
  {
    url: "signal-2025-12-16-162513.jpeg",
  },
  {
    url: "signal-2025-12-16-162513_002.jpeg",
  },
  {
    url: "signal-2025-12-16-162513_003.jpeg",
  },
  {
    url: "signal-2025-12-16-162513_004.jpeg",
  },
  {
    url: "signal-2025-12-16-162513_006.jpeg",
  },
  {
    url: "signal-2025-12-16-162513_005.jpeg",
  },
];
// Events data
const eventsData = [{
    id: 1,
    date: "23 февраля, 2025",
    title: "Первая поездка на Ислочь",
    description: "Красивая дорога, красивое место. Мы с тобой будто всю местность изучили там и зареклись почаще сюда приезжать, так и вышло) А после поехали встречать закат посреди Минского моря на льду.",
    images: [{
    url: "signal-2025-12-16-160747_002.jpeg",
  },
  {
    url: "signal-2025-12-16-160747_003.jpeg",
  },
    ],
  },
  {
    id: 2,
    date: "1 мая, 2025",
    title: "Изучение полей)",
    description: "Одна из самых прикольных наших поездок, если учесть обстоятельства, просто взяли и поехали в поле) Еще и кучу эмоций получили, если не учитывать тот факт, что ты немного кабанов боялась)",
    images: [{
    url: "signal-2025-12-16-160747_009.jpeg",
  },
  {
    url: "signal-2025-12-16-160747_008.jpeg",
  },
  {
    url: "signal-2025-12-16-160747_010.jpeg",
  },
    ],
  },
  {
    id: 3,
    date: "9 мая, 2025",
    title: "Чудный рассвет",
    description: "Ооооо, та самая случайная поездка до Смолевичей... А сначала просто среди ночи собрались на тусовку) Почему бы и нет) Всегда люблю твои такие настроения, внезапные, но захватывающие",
    images: [{
    url: "signal-2025-12-16-160747_011.jpeg",
  },
  {
    url: "PXL_20250509_023039948.jpg",
  },
  {
    url: "PXL_20250509_023041545.jpg",
  },
  {
    url: "PXL_20250509_023344749.MP.jpg",
  },
    ],
  },
  {
    id: 4,
    date: "6 июля, 2025",
    title: "Путешествие до Новогрудка",
    description: "Кратко и по делу: потрясающий маршрут, куча впечатлений, наши друзья - ленивки)",
    images: [
  {
    url: "signal-2025-12-16-160747_013.jpeg",
  },
  {
    url: "PXL_20250706_105810791.MP.jpg",
  },
  {
    url: "PXL_20250706_145603113.MP.jpg",
  },
  {
    url: "PXL_20250706_163006780.jpg",
  },
  {
    url: "PXL_20250706_165903112.MP.jpg",
  },{
    url: "signal-2025-12-16-160747_012.jpeg",
  },
    ],
  },
  {
    id: 5,
    date: "25 июля, 2025",
    title: "Покатушки в Крээээээва ",
    description: "Очень запомнилась эта поездка, особенно исторические моменты, и как ты просвящала меня местами через видео и всё такое, хочу снова на Усадьбу Огинского",
    images: [{
    url: "PXL_20250725_115702951.MP.jpg",
  },
  {
    url: "PXL_20250725_132829780.MP.jpg",
  },
  {
    url: "PXL_20250725_142426597.MP.jpg",
  },
  {
    url: "signal-2025-12-16-160747_014.jpeg",
  },
  {
    url: "PXL_20250725_172920184.jpg",
  },
    ],
  },
  {
    id: 6,
    date: "31 июля, 2025",
    title: "Поездами по Витебщине ",
    description: "Ух, а это вообще отвал башки. Столько стресса, столько нервов, столько спешки... Но это было незабываемое приключение и я бы с удовольствием повторил подобный экспириенс",
    images: [{
    url: "PXL_20250731_090408251.jpg",
  },
  {
    url: "PXL_20250731_084135117.jpg",
  },
  {
    url: "PXL_20250731_125837557.jpg",
  },
  {
    url: "PXL_20250731_131642604.MP.jpg",
  },
  {
    url: "PXL_20250731_133301790.MP.jpg",
  },
  {
    url: "signal-2025-12-16-160747_015.jpeg",
  },
    ],
  },
  {
    id: 7,
    date: "3 августа, 2025",
    title: "Подсолнухи ",
    description: "ПОДСОЛНУХИИИИИИИИИИИИ!",
    images: [{
    url: "PXL_20250803_174933116.jpg",
  },
  {
    url: "PXL_20250803_175949458.MP.jpg",
  },
  {
    url: "PXL_20250803_180529265.MP.jpg",
  },
  {
    url: "PXL_20250803_180545275.MP.jpg",
  },
    ],
  },
  {
    id: 8,
    date: "13 августа, 2025",
    title: "И снова рассвет... ",
    description: "Тот самый день, когда мы пытались заснять небо при свете Луны, но что-то пошло не так) А после встретили чудный рассвет у Лошицы. Туман впечатляет, а ты на его фоне еще больше)",
    images: [{
    url: "PXL_20250813_010816289.jpg",
  },
  {
    url: "PXL_20250813_023948366.MP.jpg",
  },
  {
    url: "PXL_20250813_031356973.MP.jpg",
  },
  {
    url: "signal-2025-12-16-160747_017.jpeg",
  },  
    ],
  },
  {
    id: 9,
    date: "4 октября, 2025",
    title: "Отдых на Воложине ",
    description: "Поездка один большой прикол от и до, особенно на моменте со стогами сена) Культурная программа в тот день была 10/10",
    images: [{
    url: "signal-2025-12-16-162513.jpeg",
  },
  {
    url: "PXL_20251004_144048219.MP.jpg",
  },
  {
    url: "signal-2025-12-16-162513_002.jpeg",
  },
    ],
  },
];

function shuffleArray(array) {
  const shuffled = [...array];
  for (let i = shuffled.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
  }
  return shuffled;
}
const shuffledImages = shuffleArray(heroImages).slice(0,5);
// Rendering
function renderHeroSwiper() {
  const swiperWrapper = document.querySelector(".hero-swiper .swiper-wrapper");
  if (!swiperWrapper) return;

  swiperWrapper.innerHTML = shuffledImages
    .map(
      (item, index) => `
    <article class="swiper-slide hero-card" aria-label="Highlight ${
      index + 1
    }">
      <div class="hero-card__image-wrapper">
        <img
          class="hero-card__image"
          src="${item.url}"
          loading="lazy"
        />
      </div>
      <div class="hero-card__body">
        <div class="hero-card__meta-row">
          <span class="hero-card__pill">2025 · ${index + 1}/${
    shuffledImages.length
  }</span>
        </div>
      </div>
    </article>
  `
    )
    .join("");
}



function renderEvents() {
  const container = document.getElementById("events-container");
  if (!container) return;

  const fragment = document.createDocumentFragment();

  eventsData.forEach((event) => {
    const section = document.createElement("section");
    section.className = "event-section";
    section.id = `event-${event.id}`;
    section.setAttribute("data-aos", "fade-up");
    section.setAttribute("tabindex", "-1");

    const hasMultipleImages = event.images.length > 1;

    section.innerHTML = `
      <div class="event-section__header">
        <div class="event-date">${event.date}</div>
        <h2 class="event-title">${event.title}</h2>
        <div class="event-copy">
          <p class="event-description">${event.description}</p>
          <div class="event-actions" aria-label="Event actions"></div>
        </div>
      </div>
      <div class="event-content">
        <div class="event-media">
          ${
            hasMultipleImages
              ? `
              <div class="swiper event-media-swiper" aria-label="${
                event.title
              } gallery">
                <div class="swiper-wrapper">
                  ${event.images
                    .map(
                      (img) => `
                      <figure class="swiper-slide event-image-wrapper">
                        <img src="${img.url}" loading="lazy" />
                      </figure>
                    `
                    )
                    .join("")}
                </div>
                <div class="swiper-pagination" aria-hidden="true"></div>
              </div>
            `
              : `
              <figure class="event-image-wrapper">
                <img src="${event.images[0].url}" loading="lazy" />
              </figure>
            `
          }
        </div>
      </div>
    `;



    fragment.appendChild(section);
  });

  container.innerHTML = "";
  container.appendChild(fragment);
}

// Swiper initialization
function initializeSwipers() {
  if (typeof Swiper === "undefined") return;

  // Hero swiper
  const heroSwiperEl = document.querySelector(".hero-swiper");
  if (heroSwiperEl) {
    // eslint-disable-next-line no-new
    new Swiper(heroSwiperEl, {
      effect: "cards",
      cardsEffect: {
        slideShadows: false,
        perSlideOffset: 15,
        perSlideRotate: 2,
      },
      grabCursor: true,
      centeredSlides: true,
      slidesPerView: "auto",

      breakpoints: {
        320: {
          cardsEffect: {
            perSlideOffset: 12,
            perSlideRotate: 1.5,
          },
        },
        768: {
          cardsEffect: {
            perSlideOffset: 18,
            perSlideRotate: 2.2,
          },
        },
        1024: {
          cardsEffect: {
            perSlideOffset: 22,
            perSlideRotate: 2.6,
          },
          pagination: {
            el: ".hero-swiper .swiper-pagination",
            clickable: true,
          },
        },
      },
    });
  }

  // Event media swipers
  const eventMediaSwipers = document.querySelectorAll(".event-media-swiper");
  eventMediaSwipers.forEach((swiperEl, index) => {
    const paginationEl = swiperEl.querySelector(".swiper-pagination");

    // eslint-disable-next-line no-new
    new Swiper(swiperEl, {
      effect: 'fade',
      fadeEffect: {
        crossFade: true
      },
      slidesPerView: 1,
      pagination: {
        el: paginationEl,
        clickable: true,
      },
    });
  });
}

// AOS
function setupAnimations() {
  if (typeof AOS === "undefined") return;

  AOS.init({
    duration: 800,
    offset: 100,
    once: true,
    mirror: false,
    disable: "mobile",
  });
}

// Timeline progress based on last event
function setupTimelineProgress() {
  const progressEl = document.querySelector(".timeline__progress");
  if (!progressEl || eventsData.length === 0) return;

  const lastEvent = eventsData[eventsData.length - 1];
  progressEl.style.width = `${progress}%`;
}

// Back to top button
function setupBackToTop() {
  const btn = document.querySelector(".back-to-top");
  if (!btn) return;

  const onScroll = () => {
    const shouldShow = window.scrollY > 400;
    btn.classList.toggle("is-visible", shouldShow);
  };

  window.addEventListener("scroll", onScroll, {
    passive: true
  });

  btn.addEventListener("click", () => {
    window.scrollTo({
      top: 0,
      behavior: "smooth"
    });
  });
}

// Theme toggle
function setupThemeToggle() {
  const toggle = document.querySelector(".theme-toggle");
  if (!toggle) return;

  const THEME_KEY = "year-review-theme";

  const applyTheme = (theme) => {
    if (theme === "light") {
      document.documentElement.setAttribute("data-theme", "light");
    } else {
      document.documentElement.removeAttribute("data-theme");
    }
  };

  const storedTheme = window.localStorage.getItem(THEME_KEY);
  if (storedTheme) {
    applyTheme(storedTheme);
  }

  toggle.addEventListener("click", () => {
    const isLight =
      document.documentElement.getAttribute("data-theme") === "light";
    const nextTheme = isLight ? "dark" : "light";
    applyTheme(nextTheme);
    window.localStorage.setItem(THEME_KEY, nextTheme);
  });
}

// Keyboard navigation helpers
function setupKeyboardNavigation() {
  // Allow tab focus outlines naturally
  document.body.addEventListener(
    "keyup",
    (event) => {
      if (event.key === "Tab") {
        document.documentElement.classList.add("user-is-tabbing");
      }
    }, {
      once: true
    }
  );
}

// DOMContentLoaded bootstrap
document.addEventListener("DOMContentLoaded", () => {
  renderHeroSwiper();
  renderEvents();
  initializeSwipers();
  setupAnimations();
  setupTimelineProgress();
  setupBackToTop();
  setupThemeToggle();
  setupKeyboardNavigation();
});
